<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Splunk Queries for SRE - Part 2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="background-glow"></div>

    <header class="hero">
        <div class="container">
            <div class="badge">SRE Toolkit</div>
            <h1>Splunk Queries for SRE <span class="accent">Part 2</span></h1>
            <p class="subtitle">Mapping API Dependencies & Identifying Failure Points.</p>
            <div class="nav-buttons">
                <a href="index.html" class="nav-btn"><i class="fa-solid fa-arrow-left"></i> Back to Part 1</a>
            </div>
        </div>
    </header>

    <main class="container">

        <!-- API Inventory Section -->
        <section class="card" id="api-inventory">
            <div class="card-header">
                <div class="icon-box inventory-icon">
                    <i class="fa-solid fa-list-check"></i>
                </div>
                <div class="header-text">
                    <h2>API Inventory</h2>
                    <p>Tabulate a unique list of APIs to understand the landscape.</p>
                </div>
            </div>
            <div class="card-content">
                <div class="guideline">
                    <h3><i class="fa-solid fa-lightbulb"></i> Why it matters</h3>
                    <p>Knowing what exists is the first step to reliability. Use this to detect deprecated endpoints or
                        unexpected new services.</p>
                </div>

                <div class="query-block">
                    <div class="query-header">
                        <span>Unique List of APIs & Methods</span>
                        <button class="copy-btn" onclick="copyToClipboard('query-inventory')"><i
                                class="fa-regular fa-copy"></i> Copy</button>
                    </div>
                    <pre><code id="query-inventory" class="language-splunk">index=your_app_index sourcetype=your_app_sourcetype 
| stats count, avg(duration) as avg_latency, max(duration) as max_latency by uri_path, method 
| sort - count 
| table uri_path, method, count, avg_latency, max_latency</code></pre>
                </div>
            </div>
        </section>

        <!-- Dependency Mapping Section -->
        <section class="card" id="dependency-mapping">
            <div class="card-header">
                <div class="icon-box dependency-icon">
                    <i class="fa-solid fa-diagram-project"></i>
                </div>
                <div class="header-text">
                    <h2>Dependency Mapping</h2>
                    <p>Visualize API-to-API and API-to-Backend relationships.</p>
                </div>
            </div>
            <div class="card-content">
                <div class="guideline">
                    <h3><i class="fa-solid fa-lightbulb"></i> How to identify dependencies</h3>
                    <p>Use a correlation ID (like <code>trace_id</code>) that propagates through the call chain. Join
                        events based on this ID to see the flow.</p>
                </div>

                <div class="query-block">
                    <div class="query-header">
                        <span>API Calling Another API (Internal Calls)</span>
                        <button class="copy-btn" onclick="copyToClipboard('query-api-call')"><i
                                class="fa-regular fa-copy"></i> Copy</button>
                    </div>
                    <pre><code id="query-api-call" class="language-splunk">index=your_app_index 
| transaction trace_id startswith="incoming_request" endswith="outgoing_request" 
| table trace_id, source_service, target_service, duration 
| stats count by source_service, target_service</code></pre>
                </div>

                <div class="query-block" style="margin-top: 20px;">
                    <div class="query-header">
                        <span>API Calling Backend (Database/Cache)</span>
                        <button class="copy-btn" onclick="copyToClipboard('query-backend-call')"><i
                                class="fa-regular fa-copy"></i> Copy</button>
                    </div>
                    <pre><code id="query-backend-call" class="language-splunk">index=your_app_index type=db_query OR type=cache_access 
| stats count, avg(duration) as avg_duration by calling_api, backend_resource_type, backend_resource_name 
| table calling_api, backend_resource_type, backend_resource_name, count, avg_duration</code></pre>
                </div>
            </div>
        </section>

        <!-- SRE Guidelines Section -->
        <section class="card" id="sre-guidelines">
            <div class="card-header">
                <div class="icon-box sre-icon">
                    <i class="fa-solid fa-shield-heart"></i>
                </div>
                <div class="header-text">
                    <h2>SRE Guidelines for Resiliency</h2>
                    <p>Using data to detect failure points.</p>
                </div>
            </div>
            <div class="card-content">
                <ul class="feature-list">
                    <li>
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <div>
                            <strong>Identify Single Points of Failure (SPOF)</strong>
                            <p>Look for backends that are called by many critical APIs. If
                                <code>backend_resource_name</code> appears frequently across different
                                <code>calling_api</code>s, it's a potential SPOF.</p>
                        </div>
                    </li>
                    <li>
                        <i class="fa-solid fa-arrows-spin"></i>
                        <div>
                            <strong>Detect Circular Dependencies</strong>
                            <p>Trace the path of requests. If Service A calls Service B, which calls Service A, you have
                                a loop that can cause cascading failures.</p>
                        </div>
                    </li>
                    <li>
                        <i class="fa-solid fa-stopwatch-20"></i>
                        <div>
                            <strong>Timeout Mismatches</strong>
                            <p>Compare <code>max_latency</code> of the downstream service with the timeout setting of
                                the upstream caller. Ensure the caller waits long enough but fails fast when needed.</p>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

    </main>

    <footer>
        <p>Designed for SRE Excellence &bull; <a href="https://github.com/jogidev/SRE_Splunk">View on GitHub</a></p>
    </footer>

    <script src="script.js"></script>
</body>

</html>